# REGRAS DO SISTEMA - INVENTÁRIO E CADASTRO

## INSTRUÇÕES OBRIGATÓRIAS PARA DESENVOLVIMENTO

### 1. DOCUMENTAÇÃO
- Toda nova funcionalidade precisa ser registrada na documentação em /documentacao
- Atualizar a documentação conforme mudanças no sistema
- Descrever propósito, parâmetros e exemplos de uso

### 2. PADRÕES DE CÓDIGO
- As funções precisam ser escritas de forma clara e modular
- Utilizar TypeScript para tipagem estrita
- Criar components reutilizáveis para formulários
- Evitar lógica de negócio nos componentes — usar hooks separados
- Seguir convenções de nomenclatura consistentes

### 3. PERSISTÊNCIA DE DADOS
- Utilizar Supabase para todas as operações de banco de dados
- Implementar autenticação via Supabase Auth
- Garantir que todas as tabelas tenham relacionamentos adequados
- Implementar validação tanto no frontend quanto no backend

### 4. VALIDAÇÃO E UX
- Garantir que todos os formulários tenham validação
- Implementar feedback visual para ações do usuário
- Criar mensagens de erro claras e úteis
- Implementar loading states adequados

### 5. DESIGN E RESPONSIVIDADE ⭐ OBRIGATÓRIO
- **DOCUMENTO DE REFERÊNCIA**: Sempre consultar `PADRAO_ESTILIZACAO_SISTEMA.md` antes de criar/modificar telas
- O layout DEVE ser completamente responsivo para mobile, tablet e desktop
- Utilizar TailwindCSS para estilização com breakpoints:
  * Mobile first: classes base sem prefixo
  * sm: (≥640px) - tablets pequenos
  * md: (≥768px) - tablets
  * lg: (≥1024px) - desktops pequenos
  * xl: (≥1280px) - desktops grandes
- **PALETA DE CORES PADRÃO**:
  * Slate (bg-slate-50, bg-slate-700, text-slate-600, etc.) - Interface principal
  * Verde (bg-green-50, text-green-800) - Sucesso/Ativo
  * Vermelho (bg-red-50, text-red-800) - Erro/Excluir
  * Roxo (bg-purple-100, text-purple-800) - Estados especiais
- **PADRÕES OBRIGATÓRIOS DE RESPONSIVIDADE**:
  * Container principal: `p-3 sm:p-4 md:p-6 max-w-full overflow-x-hidden`
  * Cabeçalho: Background branco com shadow, border-b, título + contador de registros
  * Botões ordem: Baixar Modelo → Importar Excel → Adicionar/Criar
  * Botão primário: `bg-slate-700 hover:bg-slate-800` (não usar blue)
  * Botão secundário: `border border-slate-300 bg-white hover:bg-slate-50`
  * Cabeçalhos: `flex-col sm:flex-row sm:items-center sm:justify-between gap-4`
  * Ícones: `w-4 h-4 sm:w-5 sm:h-5` com margem condicional `sm:mr-2`
  * Tabelas: Header com `bg-slate-50`, hover com `hover:bg-slate-50 transition-colors`
  * Badges: `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium`
  * Modais: `bg-slate-50` no header e footer, shadow-xl, padding responsivo
  * Cards grid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4`
  * Sempre usar `min-w-0` e `truncate` para evitar overflow de texto
  * Sempre usar `flex-shrink-0` em ícones e badges para evitar compressão
- **TELAS DE REFERÊNCIA**: CadastroColaborador.tsx, CadastroItem.tsx, LinhasTelefonicas.tsx
- **PREVENÇÃO DE SCROLL HORIZONTAL**:
  * Adicionar `overflow-x-hidden` no container principal
  * Usar `min-w-0` em elementos flex para permitir shrinking
  * Aplicar `max-w-full` globalmente
  * Testar em telas de 320px, 640px, 768px, 1024px e 1280px
- Manter consistência visual em todos os componentes
- Cores: Usar palette slate para elementos principais
- Sombras: `shadow-sm` em botões, `shadow` em cards

### 6. ARQUITETURA E ORGANIZAÇÃO
- O código deve estar organizado em pastas por domínio:
  - /features/empresa
  - /features/colaborador  
  - /features/inventario
  - /features/auth
- Usar Context API ou Zustand para estado global
- Implementar roteamento protegido com React Router
- Separar lógica de apresentação da lógica de negócio

### 7. SEGURANÇA - ⚠️ CRÍTICO - OBRIGATÓRIO
- **NUNCA EXPOR DADOS SENSÍVEIS NO FRONTEND**: Jamais incluir chaves privadas, senhas, tokens secretos ou credenciais administrativas no código do frontend
- **USAR APENAS CHAVES PÚBLICAS**: No frontend, usar somente as chaves públicas (anon key) do Supabase
- **VARIÁVEIS DE AMBIENTE**: Sempre prefixar com VITE_ apenas dados que podem ser públicos
- **LOGS E CONSOLE PROIBIDOS**: 
  * Jamais fazer console.log() de URLs, tokens, emails ou senhas
  * Nunca logar responses completas de APIs
  * Desabilitar debug do Supabase em produção
  * Remover todos os console.log antes do deploy
- **URLs E ENDPOINTS**: Nunca expor URLs completas de APIs no console do navegador
- **TRATAMENTO DE ERROS**: Logs de erro devem ser genéricos, sem expor detalhes técnicos
- **ROW LEVEL SECURITY**: Sempre habilitar RLS no Supabase para proteger dados
- **VALIDAÇÃO DUPLA**: Validar tanto no frontend quanto no backend
- Implementar autenticação em todas as rotas protegidas
- Validar permissões de usuário antes de operações sensíveis
- Sanitizar inputs do usuário
- Implementar rate limiting quando necessário

### 8. PROCESSO DE DESENVOLVIMENTO
- Ler esse arquivo antes de escrever qualquer código novo
- Testar funcionalidades antes de marcar como concluída
- Manter commits organizados e descritivos
- Documentar decisões técnicas importantes

### 9. ESTRUTURA DE DADOS
- Tabelas principais: empresas, colaboradores, itens
- Implementar relacionamentos adequados entre tabelas
- Manter consistência nos campos de auditoria (created_at, updated_at)
- Utilizar UUIDs como chaves primárias

### 10. PERFORMANCE
- Implementar lazy loading quando apropriado
- Otimizar queries do Supabase
- Implementar cache quando necessário
- Minimizar re-renders desnecessários

### 11. CONTROLE DE PERMISSÕES - ⚠️ OBRIGATÓRIO
- **SEMPRE QUE CRIAR UM NOVO MENU OU SUBMENU, DEVEMOS CONFIGURAR OS PARÂMETROS PARA LIBERAR OU BLOQUEAR ACESSO NA TELA DE USUÁRIOS E EDITAR USUÁRIOS**
- Toda nova tela/funcionalidade deve ter uma permissão associada
- **CHECKLIST COMPLETO para adicionar novo menu/submenu:**
  1. ✅ **Criar componente da tela** (ex: `ConsultarNotasFiscais.tsx`)
  2. ✅ **Adicionar rota no App.tsx** com `<PermissionGuard>`:
     ```tsx
     <Route path="/notas-fiscais/consultar" element={
       <PermissionGuard requiredPermissions={['notas_fiscais_consultar']}>
         <ConsultarNotasFiscais />
       </PermissionGuard>
     } />
     ```
  3. ✅ **Adicionar permissão na interface Permissoes** (`src/shared/hooks/usePermissions.tsx`):
     ```typescript
     export interface Permissoes {
       notas_fiscais_consultar: boolean
     }
     ```
  4. ✅ **Adicionar valor default no usePermissions.tsx**:
     ```typescript
     notas_fiscais_consultar: false
     ```
  5. ✅ **Adicionar no menu lateral** (`src/shared/components/Layout.tsx`) com verificação:
     ```tsx
     {hasPermission('notas_fiscais_consultar') && (
       <li onClick={() => openConsultarNotasFiscais()}>...</li>
     )}
     ```
  6. ✅ **Adicionar função de abertura** no `useTabOpener.tsx`
  7. ✅ **Mapear rota para permissão** no `TabBar.tsx`:
     ```typescript
     const routePermissionMap = {
       '/notas-fiscais/consultar': 'notas_fiscais_consultar'
     }
     ```
  8. ✅ **Adicionar na Interface Usuario** (`GerenciarUsuarios.tsx`):
     ```typescript
     interface Usuario {
       permissoes: {
         notas_fiscais_consultar: boolean
       }
     }
     ```
  9. ✅ **Adicionar valor padrão** em formData e resetForm no `GerenciarUsuarios.tsx`
  10. ✅ **Adicionar no array permissoesModulos** (`GerenciarUsuarios.tsx`):
      ```typescript
      { key: 'notas_fiscais_consultar' as const, label: 'Consultar Notas Fiscais', grupo: 'Notas Fiscais' }
      ```
  11. ✅ **Criar script SQL** para adicionar permissão aos usuários ativos:
      ```sql
      UPDATE usuarios 
      SET permissoes = jsonb_set(
        COALESCE(permissoes, '{}'::jsonb),
        '{notas_fiscais_consultar}',
        'true',
        true
      )
      WHERE ativo = true;
      ```
- Nomenclatura de permissões: `modulo_acao` (ex: `vendas_parametros`, `cadastro_empresa`, `notas_fiscais_consultar`)
- Sempre proteger rotas e menu lateral com verificação de permissão
- **IMPORTANTE**: Permissões são armazenadas no campo JSON `permissoes` na tabela `usuarios`, NÃO em colunas individuais
